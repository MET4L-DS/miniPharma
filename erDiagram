%%-------------------------------GUIDELINES FOR TABLE & ATTRIBUTES------------------------------------------
erDiagram
%% how to write ER diagram in text format to automatically generate as image
%% use snake case for table name and attributes for consistency sake
%% PK -> primary key | FK -> forign key | UK -> unique key
%% 
%% table_name {
%%         data_type attribute_name PK/FK/UK/blank "write comment inside inverted comma if required"
%% }


%% ----------------------------------------TABLE AND ATTRIBUTES--------------------------------------
    %% strong entity
    USER {
        string phone_number PK
        string username
        string password_hash
        string role
        datetime last_login
        bool is_active
    }
    
    %% strong entity
    MEDICINE {
        string medicine_id PK
        int composition_id FK
        string name
        string brand
        string hsn_code
        float gst_rate
        bool requires_prescription
        string therapeutic_category
    }

    %% weak entity depends on MEDICINE
    CHEMICAL_COMPOSITION {
        int composition_id FK
        string chemical_name
        string strength
    }

    %% two medici might have same batch number
    %% average_purchase_price because same batch medicine might have purchased on different price
    BATCH {
        string batch_number PK
        string medicine_id PK,FK
        date expiry_date
        decimal selling_price "AT MRP"
        int quantity_in_stock
        decimal average_purchase_price
    }

    CUSTOMER {
        string customer_id PK
        string name
        string phone
        string email    "OPTIONAL"
        date registration_date
        int loyalty_points
    }

    PRESCRIPTION {
        string prescription_id PK
        string customer_id FK
        string doctor_id FK
        date issue_date
        date valid_until
        string digital_copy_url
    }

    DOCTOR {
        string doctor_id PK
        string name
        string registration_number
        string specialization
        string contact_number
    }

    INVOICE {
        string invoice_id PK
        string customer_id FK
        datetime invoice_date
        decimal total_amount
        decimal discount_amount
        string payment_id
        string prescription_id FK
    }

    PAYMENT {
        string payment_id PK, FK
        string payment_type "UPI, CASH, CARD"
        string transaction_id "FOR CASH 420"
        float transaction_amount
    }

    ALERT {
        string alert_id PK
        string batch_id FK
        string medicine_id FK
        string alert_type
        datetime generated_on
        string status
    }


%% ----------------------------------------GUIDELINES FOR RELATIONSHIP & CONSTRAINTS--------------------------------------
%% how to show relationship between table and their constriants
%%  <first-entity> [<relationship> <second-entity> : <relationship-label>]
%% 
%% Value (left)	Value (right)	Meaning
%%         |o	        o|	Zero or one
%%         ||        	||	Exactly one
%%         }o        	o{	Zero or more (no upper limit)
%%         }|        	|{	One or more (no upper limit)
%% 
%% Value	Alias for
%% --	identifying
%% ..	non-identifying
%% 
%% EXAMPLE:
%%     CAR ||--o{ DRIVER : allows
%%     PERSON }o..o{ DRIVER : is

%% ------------------------------------------------RELATIONSHIP & CONSTRAINTS----------------------------------------------
    %% Relationships
    DOCTOR ||--|{ PRESCRIPTION : "issues"
    CUSTOMER ||--|{ PRESCRIPTION : "receives"
    PRESCRIPTION ||--|{ MEDICINE : "contains"
    MEDICINE ||--|{ BATCH : "is available in"
    MEDICINE }|--|| CHEMICAL_COMPOSITION : "has composition"
    CUSTOMER ||--|{ INVOICE : "receives"
    USER ||--|{ INVOICE : "generates"
    INVOICE ||--|| PAYMENT : "is paid by"
    INVOICE ||--|{ PRESCRIPTION : "is generated for"
    BATCH ||--|{ ALERT : "triggers"
    MEDICINE ||--|{ ALERT : "triggers"
